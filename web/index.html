<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Whale Sounds</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            text-align: center;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            background-color: #000;
            overflow: hidden;
        }

        html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
        }

        .background-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        .background-image {
            width: 100%;
            height: 100%;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            animation: zoomEffect 15s ease-in-out infinite;
        }

        @keyframes zoomEffect {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.10);
            }

            100% {
                transform: scale(1);
            }
        }

        #connectionInfo {
            font-family: monospace;
            font-size: 16px;
            background-color: #e0e0e0;
            border: none;
            width: 20%;
            margin: auto;
            /* Centering the output box */
            overflow-wrap: break-word;
        }

        #userCount {
            font-weight: bold;
            color: #555;
        }

        #output {
            color: #666;
        }
    </style>
</head>

<body>
    <h2>Welcome to Whale Sounds.org!</h2>
    <div id="connectionInfo">
        <div id="userCount">Connected Users: <span id="userCountValue">0</span></div>
        <div id="output"></div>
    </div>

    <div class="background-container">
        <div class="background-image" id="backgroundImage"></div>
    </div>

    <script>
        window.onload = function () {
            if (!window["WebSocket"]) {
                document.getElementById("output").innerHTML = "WebSockets are not supported by your browser.";
                return;
            }

            console.log("supports websockets");
            var output = document.getElementById("output");
            var userCount = document.getElementById("userCountValue");
            var socket = new WebSocket("ws://" + document.location.host + "/ws");

            socket.onopen = function () {
                output.innerHTML = "Status: Connected\n";
                socket.send("New Connection!");
            };

            socket.onmessage = function (e) {
                console.log("message received from server: " + e.data);
                if (e.data.startsWith("UserCount:")) {
                    userCount.innerHTML = e.data.split(":")[1].trim();
                } else {
                    console.log("Unknown message from server:", e.data);
                }
            };

            socket.onerror = function (e) {
                console.log("websocket error: " + e.reason);
                output.innerHTML += "Connection error\n";
            };

            socket.onclose = function (e) {
                console.log("Websocket closed with code:", e.code, "reason:", e.reason);
                output.innerHTML = "Status: Disconnected\n";
                if (e.code !== 1000) {
                    // non-normal closure
                    // setTimeout(function () {
                    //     console.log("Attempting to reconnect...");
                    //     // window.onload(); // reinit the connection
                    // }, 5000);
                }
            };

            window.onbeforeunload = function () {
                // socket.send("Normal closure");
                socket.close(1000, "Normal closure");
            };


            // WHALE BACKGROUND CHANGE CODE
            const images = [
                '/static/img/original/whale_01.jpg',
                '/static/img/original/whale_03.jpg',
                '/static/img/original/whale_04.jpg',
                '/static/img/original/whale_05.jpg',
                '/static/img/original/whale_06.jpg',
                '/static/img/original/whale_07.jpg',
                '/static/img/original/whale_08.jpg',
            ];

            let currentIndex = 0;
            let backgroundImage = document.getElementById('backgroundImage');

            const changeBackgroundImage = () => {
                backgroundImage.style.backgroundImage = `url('${images[currentIndex]}')`;
                currentIndex = (currentIndex + 1) % images.length;
            };

            // Preload all images
            images.forEach(src => {
                const img = new Image();
                img.src = src;
            });

            setInterval(changeBackgroundImage, 10000); // 10 seconds
            changeBackgroundImage();

        };
    </script>

</body>

</html>